<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Buscador de Mesas</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url("fondo.jpg") no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }

    .contenedor {
      background: rgba(255, 255, 255, 0.85);
      border-radius: 18px;
      padding: 22px;
      max-width: 420px;
      width: 100%;
      text-align: center;
      box-shadow: 0px 8px 30px rgba(0,0,0,0.25);
      backdrop-filter: blur(6px);
    }

    h1 {
      margin: 0;
      font-size: 38px;
      font-weight: 900;
      color: #1e4d7b;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      line-height: 1.1;
    }

    .novios {
      margin-top: 8px;
      margin-bottom: 18px;
      font-size: 18px;
      font-weight: 800;
      color: #1e4d7b;
      letter-spacing: 0.3px;
      white-space: nowrap;
    }

    .instruccion {
      font-size: 20px;
      font-weight: 700;
      color: #333;
      margin-bottom: 10px;
      line-height: 1.25;
    }

    .ejemplo {
      font-size: 18px;
      color: #444;
      margin-bottom: 18px;
      font-weight: 600;
    }

    input {
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      border: 2px solid #ccc;
      font-size: 24px;
      text-align: center;
      font-weight: 800;
      box-sizing: border-box;
      margin-bottom: 15px;
      outline: none;
    }

    input:focus {
      border-color: #1e4d7b;
      box-shadow: 0px 0px 8px rgba(30, 77, 123, 0.4);
    }

    button {
      width: 100%;
      padding: 16px;
      border-radius: 14px;
      border: none;
      font-size: 22px;
      font-weight: 900;
      cursor: pointer;
      margin-bottom: 12px;
      transition: 0.2s ease-in-out;
    }

    .btnNombre {
      background: linear-gradient(180deg, #1e5fa5, #17487c);
      color: white;
    }

    .btnNombre:hover {
      transform: scale(1.02);
      filter: brightness(1.05);
    }

    .btnMesa {
      background: linear-gradient(180deg, #f2b300, #d79200);
      color: #222;
    }

    .btnMesa:hover {
      transform: scale(1.02);
      filter: brightness(1.05);
    }

    .resultados {
      margin-top: 15px;
      text-align: left;
      max-height: 280px;
      overflow-y: auto;
      padding-right: 5px;
    }

    .resultadoItem {
      background: rgba(30, 77, 123, 0.10);
      border-left: 6px solid #1e4d7b;
      border-radius: 12px;
      padding: 12px 12px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      font-size: 18px;
      font-weight: 800;
      color: #222;
    }

    .mesaBadge {
      background: linear-gradient(180deg, #f2b300, #d79200);
      color: #1a1a1a;
      font-weight: 900;
      padding: 8px 12px;
      border-radius: 12px;
      font-size: 16px;
      white-space: nowrap;
      box-shadow: 0px 3px 8px rgba(0,0,0,0.15);
    }

    .mesaTitulo {
      text-align: center;
      font-size: 22px;
      font-weight: 900;
      color: #1e4d7b;
      background: rgba(255,255,255,0.75);
      border-radius: 14px;
      padding: 10px;
      margin-bottom: 14px;
      border: 2px solid rgba(30, 77, 123, 0.25);
    }

    .contador {
      text-align: center;
      font-weight: 900;
      font-size: 18px;
      margin-top: 12px;
      color: #1e4d7b;
    }

    .mensajeError {
      text-align: center;
      font-weight: 800;
      font-size: 17px;
      margin-top: 12px;
      color: #b00020;
    }

    .resultados::-webkit-scrollbar {
      width: 8px;
    }

    .resultados::-webkit-scrollbar-thumb {
      background: rgba(30, 77, 123, 0.4);
      border-radius: 10px;
    }

    @media (max-height: 700px) {
      .resultados {
        max-height: 220px;
      }
      h1 {
        font-size: 32px;
      }
      .instruccion {
        font-size: 18px;
      }
      input {
        font-size: 20px;
      }
      button {
        font-size: 20px;
      }
    }
  </style>
</head>

<body>

  <div class="contenedor">
    <h1>üåø Buscador de Mesas</h1>

    <div class="novios">Florencia Pino & Tom√°s Godoy üíô</div>

    <div class="instruccion">
      Ingresa tu apellido o n√∫mero de mesa y presiona el bot√≥n correspondiente
    </div>

    <div class="ejemplo">
      Ejemplo: Gonz√°lez o 12
    </div>

    <input type="text" id="busqueda" placeholder="Escribe aqu√≠..." autocomplete="off" />

    <button class="btnNombre" onclick="buscarPorApellido()">üîç Buscar por Apellido</button>
    <button class="btnMesa" onclick="buscarPorMesa()">ü™ë Buscar por Mesa</button>

    <div id="resultados" class="resultados"></div>

    <div id="contador" class="contador"></div>
    <div id="mensajeError" class="mensajeError"></div>
  </div>

  <script>
    let invitados = [];

    // Quita tildes, pasa a min√∫sculas, elimina espacios dobles
    function normalizarTexto(texto) {
      return texto
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .replace(/\s+/g, " ")
        .trim();
    }

    async function cargarCSV() {
      try {
        const response = await fetch("invitados.csv");
        const data = await response.text();

        const lineas = data.split("\n").map(l => l.trim()).filter(l => l.length > 0);

        // Detectar encabezados
        const encabezados = lineas[0].split(",").map(e => e.trim().toLowerCase());

        const idxNombre = encabezados.indexOf("nombre");
        const idxMesa = encabezados.indexOf("mesa");

        invitados = lineas.slice(1).map(linea => {
          const partes = linea.split(",").map(p => p.trim());
          return {
            nombre: partes[idxNombre] || "",
            mesa: partes[idxMesa] || ""
          };
        });

      } catch (error) {
        console.error("Error cargando CSV:", error);
        document.getElementById("mensajeError").innerText =
          "‚ö†Ô∏è Error al cargar la lista de invitados. Revisa el archivo invitados.csv.";
      }
    }

    function limpiarPantalla() {
      document.getElementById("resultados").innerHTML = "";
      document.getElementById("contador").innerText = "";
      document.getElementById("mensajeError").innerText = "";
    }

    function buscarPorApellido() {
      limpiarPantalla();

      const texto = document.getElementById("busqueda").value;
      const busqueda = normalizarTexto(texto);

      if (!busqueda) {
        document.getElementById("mensajeError").innerText =
          "‚ö†Ô∏è Escribe un apellido antes de buscar.";
        return;
      }

      const resultados = invitados.filter(inv => {
        const nombreNormalizado = normalizarTexto(inv.nombre);

        // dividir palabras del nombre completo
        const palabras = nombreNormalizado.split(" ");

        // buscar coincidencia EXACTA por palabra (evita pino dentro de espinoza)
        return palabras.includes(busqueda);
      });

      mostrarResultados(resultados, false);
    }

    function buscarPorMesa() {
      limpiarPantalla();

      const texto = document.getElementById("busqueda").value.trim();

      if (!texto || isNaN(texto)) {
        document.getElementById("mensajeError").innerText =
          "‚ö†Ô∏è Ingresa un n√∫mero de mesa v√°lido.";
        return;
      }

      const mesaBuscada = texto;

      // IMPORTANTE: filter() para traer TODOS los invitados de la mesa
      const resultados = invitados.filter(inv => inv.mesa.trim() === mesaBuscada);

      mostrarResultados(resultados, true, mesaBuscada);
    }

    function mostrarResultados(resultados, esMesa, mesaBuscada = "") {
      const divResultados = document.getElementById("resultados");
      const divContador = document.getElementById("contador");

      if (resultados.length === 0) {
        document.getElementById("mensajeError").innerText =
          "‚ùå No se encontraron resultados. Prueba con otro apellido o mesa.";
        return;
      }

      if (esMesa) {
        divResultados.innerHTML += `<div class="mesaTitulo">ü™ë MESA ${mesaBuscada}</div>`;
      }

      resultados.forEach(inv => {
        const nombre = inv.nombre;
        const mesa = inv.mesa;

        divResultados.innerHTML += `
          <div class="resultadoItem">
            <div>${nombre}</div>
            <div class="mesaBadge">Mesa ${mesa}</div>
          </div>
        `;
      });

      divContador.innerText = `Invitados encontrados: ${resultados.length}`;
    }

    // Cargar autom√°ticamente al abrir la p√°gina
    cargarCSV();

    // Enter busca por apellido autom√°ticamente
    document.getElementById("busqueda").addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
        buscarPorApellido();
      }
    });
  </script>

</body>
</html>
