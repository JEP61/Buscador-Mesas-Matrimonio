<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Buscador de Mesas</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 18px;
      box-sizing: border-box;

      background-image: url("fondo.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    .card {
      position: relative;
      width: 100%;
      max-width: 720px;
      background: rgba(255, 255, 255, 0.72);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 22px;
      padding: 28px;
      box-shadow: 0px 10px 35px rgba(0,0,0,0.25);
    }

    h1 {
      margin: 0;
      font-size: 42px;
      text-align: center;
      color: #133d66;
      font-weight: 900;
      letter-spacing: 0.5px;
    }

    .subtitle {
      margin-top: 12px;
      font-size: 24px;
      text-align: center;
      color: #222;
      font-weight: 800;
    }

    .example {
      margin-top: 8px;
      font-size: 20px;
      text-align: center;
      color: #444;
      font-weight: 600;
    }

    input {
      width: 100%;
      padding: 18px;
      font-size: 24px;
      border-radius: 14px;
      border: 1px solid #ccc;
      outline: none;
      margin-top: 20px;
      box-sizing: border-box;
      font-weight: 700;
    }

    .buttons {
      display: flex;
      gap: 14px;
      margin-top: 18px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      flex: 1;
      min-width: 220px;
      padding: 16px;
      border: none;
      border-radius: 14px;
      font-size: 20px;
      font-weight: 900;
      cursor: pointer;
      transition: 0.2s;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .btn-nombre {
      background: #0b4c9c;
      color: white;
    }

    .btn-nombre:hover {
      background: #083b78;
    }

    .btn-mesa {
      background: #f0b400;
      color: #222;
    }

    .btn-mesa:hover {
      background: #e6a600;
    }

    .status {
      margin-top: 18px;
      font-size: 18px;
      font-weight: 800;
      text-align: center;
      color: #1a1a1a;
    }

    .resultados {
      margin-top: 22px;
      max-height: 440px;
      overflow-y: auto;
      padding-right: 6px;
    }

    .fila {
      padding: 14px;
      border-bottom: 1px solid rgba(0,0,0,0.12);
      font-size: 22px;
      font-weight: 800;
      color: #111;
    }

    .mesa-header {
      margin-top: 18px;
      margin-bottom: 18px;
      text-align: center;
      font-size: 32px;
      font-weight: 900;
      color: #133d66;
      padding: 14px;
      border-radius: 16px;
      background: rgba(255,255,255,0.65);
      border: 2px solid rgba(19,61,102,0.2);
    }

    .contador {
      margin-top: 18px;
      text-align: center;
      font-size: 18px;
      font-weight: 800;
      color: #133d66;
    }

    .hint {
      margin-top: 10px;
      text-align: center;
      font-size: 16px;
      color: #111;
      font-weight: 700;
    }

    @media (max-width: 520px) {
      h1 { font-size: 34px; }
      .subtitle { font-size: 20px; }
      .example { font-size: 18px; }
      input { font-size: 20px; }
      button { font-size: 18px; min-width: 160px; }
      .fila { font-size: 19px; }
      .mesa-header { font-size: 26px; }
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>üåø Buscador de Mesas</h1>

    <div class="subtitle">Ingresa tu apellido o tu n√∫mero de mesa</div>
    <div class="example">Ejemplo: Gonz√°lez o 12</div>

    <input id="busqueda" type="text"
      placeholder="Escribe aqu√≠..."
      autocomplete="off"
      autocorrect="off"
      autocapitalize="off"
      spellcheck="false"
    />

    <div class="buttons">
      <button class="btn-nombre" onclick="buscarPorNombre()">üîç Buscar por Nombre</button>
      <button class="btn-mesa" onclick="buscarPorMesa()">ü™ë Buscar por Mesa</button>
    </div>

    <div class="status" id="status">Cargando invitados...</div>

    <div id="mesaHeader"></div>
    <div class="resultados" id="resultados"></div>
    <div class="contador" id="contador"></div>

    <div class="hint">Si no encuentras tu nombre, prueba con tu primer apellido üòä</div>
  </div>

  <script>
    let invitados = [];

    function limpiarTexto(texto) {
      return texto
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
    }

    async function cargarCSV() {
      try {
        const response = await fetch("invitados.csv");
        const data = await response.text();

        const lineas = data.split("\n").filter(l => l.trim() !== "");

        invitados = lineas.slice(1).map(linea => {
          const partes = linea.split(",");

          return {
            num: partes[0]?.trim(),
            nombre: partes[1]?.trim(),
            mesa: partes[2]?.trim()
          };
        });

        document.getElementById("status").innerText =
          "‚úÖ Listo. Ahora puedes buscar por apellido o por n√∫mero de mesa.";

        document.getElementById("contador").innerText =
          "Invitados cargados: " + invitados.length;

      } catch (error) {
        document.getElementById("status").innerText =
          "‚ùå Error cargando invitados.csv. Revisa que el archivo exista y est√© bien subido.";
      }
    }

    function limpiarPantalla() {
      document.getElementById("resultados").innerHTML = "";
      document.getElementById("mesaHeader").innerHTML = "";
      document.getElementById("contador").innerText = "";
    }

    function mostrarResultadosNombre(lista) {
      const contenedor = document.getElementById("resultados");
      contenedor.innerHTML = "";

      lista.forEach(inv => {
        const fila = document.createElement("div");
        fila.className = "fila";
        fila.innerText = inv.nombre + " ‚Äî Mesa " + inv.mesa;
        contenedor.appendChild(fila);
      });

      document.getElementById("contador").innerText =
        "Resultados encontrados: " + lista.length;
    }

    function mostrarResultadosMesa(lista, mesa) {
      const contenedor = document.getElementById("resultados");
      contenedor.innerHTML = "";

      const header = document.getElementById("mesaHeader");
      header.innerHTML = `<div class="mesa-header">ü™ë MESA ${mesa}</div>`;

      lista.forEach(inv => {
        const fila = document.createElement("div");
        fila.className = "fila";
        fila.innerText = inv.nombre;
        contenedor.appendChild(fila);
      });

      document.getElementById("contador").innerText =
        "Invitados en esta mesa: " + lista.length;
    }

    function buscarPorNombre() {
      limpiarPantalla();

      const texto = limpiarTexto(document.getElementById("busqueda").value);

      if (!texto) {
        alert("Por favor ingresa un apellido o nombre.");
        return;
      }

      const resultados = invitados.filter(inv => {
        const palabras = limpiarTexto(inv.nombre).split(/\s+/);
        return palabras.includes(texto);
      });

      if (resultados.length === 0) {
        document.getElementById("resultados").innerHTML =
          "<div class='status'>‚ùå No se encontraron resultados.</div>";
        return;
      }

      mostrarResultadosNombre(resultados);
    }

    function buscarPorMesa() {
      limpiarPantalla();

      const texto = limpiarTexto(document.getElementById("busqueda").value);

      if (!texto) {
        alert("Por favor ingresa un n√∫mero de mesa.");
        return;
      }

      const resultados = invitados.filter(inv => limpiarTexto(inv.mesa) === texto);

      if (resultados.length === 0) {
        document.getElementById("resultados").innerHTML =
          "<div class='status'>‚ùå No se encontraron resultados para esa mesa.</div>";
        return;
      }

      mostrarResultadosMesa(resultados, texto);
    }

    cargarCSV();
  </script>
</body>
</html>
